* Ancilliary services by Juan Gea Bermúdez 2019.

EQUATION QASFCRUPR "Ancilliary service: frequency containment reserves for up regulation per region";
EQUATION QASAFRRUPR "Ancilliary service: automatic frequency restoration reserves for up regulation per region";
EQUATION QASMFRRUPR "Ancilliary service: manual frequency restoration reserves for up regulation per region";
EQUATION QASMRRUPR "Ancilliary service: manual replacement reserves for up regulation per region";

EQUATION QASFCRDOWNR "Ancilliary service: frequency containment reserves for down regulation per region";
EQUATION QASAFRRDOWNR "Ancilliary service: automatic frequency restoration reserves for down regulation per region";
EQUATION QASMFRRDOWNR "Ancilliary service: manual frequency restoration reserves for down regulation per region";
EQUATION QASMRRDOWNR "Ancilliary service: manual replacement reserves for down regulation per region";

EQUATION QASFCRUPC "Ancilliary service: frequency containment reserves for up regulation per country";
EQUATION QASAFRRUPC "Ancilliary service: automatic frequency restoration reserves for up regulation per country";
EQUATION QASMFRRUPC "Ancilliary service: manual frequency restoration reserves for up regulation per country";
EQUATION QASMRRUPC "Ancilliary service: manual replacement reserves for up regulation per country";

EQUATION QASFCRDOWNC "Ancilliary service: frequency containment reserves for down regulation per country";
EQUATION QASAFRRDOWNC "Ancilliary service: automatic frequency restoration reserves for down regulation per country";
EQUATION QASMFRRDOWNC "Ancilliary service: manual frequency restoration reserves for down regulation per country";
EQUATION QASMRRDOWNC "Ancilliary service: manual replacement reserves for down regulation per country";

EQUATION QASSTOONUP     "Ancilliary services: up regulation limits for IGESTO and IGESTOS that are online (MW)";
EQUATION QASSTOONDOWN   "Ancilliary services: down regulation limits for IGESTO and IGESTOS that are online(MW)";
EQUATION QASESTOONENERGYUP   "Ancilliary services: minimum energy requirement for up regulation of online IGESTO units (MWh)";
EQUATION QASESTOONENERGYDOWN "Ancilliary services: minimum energy requirement for down regulation of online IGESTO units (MWh)";
EQUATION QASESTOSONENERGYUP   "Ancilliary services: minimum energy requirement for up regulation of online IGESTOS units (MWh)";
EQUATION QASESTOSONENERGYDOWN "Ancilliary services: minimum energy requirement for down regulation of online IGESTOS units (MWh)";

QASFCRUPR(IY411,IR,IS3,T)$FCRUP(IY411,IR)..
        SUM((IASFCRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASFCRUP) AND RRRAAA(IR,IA)),VASFCRUP(IY411,IA,IASFCRUP,IS3,T))
         =G=
        FCRUP(IY411,IR)
;

QASFCRDOWNR(IY411,IR,IS3,T)$FCRDOWN(IY411,IR)..
        SUM((IASFCRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASFCRDOWN) AND RRRAAA(IR,IA)),VASFCRDOWN(IY411,IA,IASFCRDOWN,IS3,T))
         =G=
        FCRDOWN(IY411,IR)
;

QASAFRRUPR(IY411,IR,IS3,T)$AFRRUP(IY411,IR)..
        SUM((IASAFRRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASAFRRUP) AND RRRAAA(IR,IA)),VASAFRRUP(IY411,IA,IASAFRRUP,IS3,T))
         =G=
        AFRRUP(IY411,IR)
;

QASAFRRDOWNR(IY411,IR,IS3,T)$AFRRDOWN(IY411,IR)..
        SUM((IASAFRRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASAFRRDOWN) AND RRRAAA(IR,IA)),VASAFRRDOWN(IY411,IA,IASAFRRDOWN,IS3,T))
         =G=
        AFRRDOWN(IY411,IR)
;

QASMFRRUPR(IY411,IR,IS3,T)$MFRRUP(IY411,IR)..
        SUM((IASMFRRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASMFRRUP) AND RRRAAA(IR,IA)),VASMFRRUP(IY411,IA,IASMFRRUP,IS3,T))
         =G=
        MFRRUP(IY411,IR)
;

QASMFRRDOWNR(IY411,IR,IS3,T)$MFRRDOWN(IY411,IR)..
        SUM((IASMFRRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASMFRRDOWN) AND RRRAAA(IR,IA)),VASMFRRDOWN(IY411,IA,IASMFRRDOWN,IS3,T))
         =G=
        MFRRDOWN(IY411,IR)
;

QASMRRUPR(IY411,IR,IS3,T)$MRRUP(IY411,IR)..
        SUM((IASMRRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASMRRUP) AND RRRAAA(IR,IA)),VASMRRUP(IY411,IA,IASMRRUP,IS3,T))
         =G=
        MRRUP(IY411,IR)
;

QASMRRDOWNR(IY411,IR,IS3,T)$MRRDOWN(IY411,IR)..
        SUM((IASMRRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASMRRDOWN) AND RRRAAA(IR,IA)),VASMRRDOWN(IY411,IA,IASMRRDOWN,IS3,T))
         =G=
        MRRDOWN(IY411,IR)
;

QASFCRUPC(IY411,C,IS3,T)$FCRUP(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASFCRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASFCRUP) AND RRRAAA(IR,IA)),VASFCRUP(IY411,IA,IASFCRUP,IS3,T)))
         =G=
        FCRUP(IY411,C)
;

QASFCRDOWNC(IY411,C,IS3,T)$FCRDOWN(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASFCRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASFCRDOWN) AND RRRAAA(IR,IA)),VASFCRDOWN(IY411,IA,IASFCRDOWN,IS3,T)))
         =G=
        FCRDOWN(IY411,C)
;

QASAFRRUPC(IY411,C,IS3,T)$AFRRUP(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASAFRRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASAFRRUP) AND RRRAAA(IR,IA)),VASAFRRUP(IY411,IA,IASAFRRUP,IS3,T)))
         =G=
        AFRRUP(IY411,C)
;

QASAFRRDOWNC(IY411,C,IS3,T)$AFRRDOWN(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASAFRRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASAFRRDOWN) AND RRRAAA(IR,IA)),VASAFRRDOWN(IY411,IA,IASAFRRDOWN,IS3,T)))
         =G=
        AFRRDOWN(IY411,C)
;

QASMFRRUPC(IY411,C,IS3,T)$MFRRUP(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASMFRRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASMFRRUP) AND RRRAAA(IR,IA)),VASMFRRUP(IY411,IA,IASMFRRUP,IS3,T)))
         =G=
        MFRRUP(IY411,C)
;

QASMFRRDOWNC(IY411,C,IS3,T)$MFRRDOWN(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASMFRRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASMFRRDOWN) AND RRRAAA(IR,IA)),VASMFRRDOWN(IY411,IA,IASMFRRDOWN,IS3,T)))
         =G=
        MFRRDOWN(IY411,C)
;

QASMRRUPC(IY411,C,IS3,T)$MRRUP(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASMRRUP,IA)$(IAGK_HASORPOT(IY411,IA,IASMRRUP) AND RRRAAA(IR,IA)),VASMRRUP(IY411,IA,IASMRRUP,IS3,T)))
         =G=
        MRRUP(IY411,C)
;

QASMRRDOWNC(IY411,C,IS3,T)$MRRDOWN(IY411,C)..
        SUM(IR$CCCRRR(C,IR),SUM((IASMRRDOWN,IA)$(IAGK_HASORPOT(IY411,IA,IASMRRDOWN) AND RRRAAA(IR,IA)),VASMRRDOWN(IY411,IA,IASMRRDOWN,IS3,T)))
         =G=
        MRRDOWN(IY411,C)
;

QASSTOONUP(IY411,IA,IGUC,IS3,T)$(IAGK_HASORPOT(IY411,IA,IGUC) AND IGESTOALL(IGUC) AND (IASFCRUP(IGUC) OR IASAFRRUP(IGUC)))..
   VUCON(IY411,IA,IGUC,IS3,T)*GDATA(IGUC,'GDUCUNITSIZE')/GDATA(IGUC,'GDSTOHUNLD')*(GDATA(IGUC,'GDFE')*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC)))

   -(  VGE_T(IY411,IA,IGUC,IS3,T)
    )

+(VESTOLOADT(IY411,IA,IGUC,IS3,T)$IGESTO(IGUC)
  +VESTOLOADTS(IY411,IA,IGUC,IS3,T)$IGESTOS(IGUC)
   -
* Fuel consumption at minimum load is defined by Fmin = [ Emin (1-F0) +Emax*F0 ]/FE
  (
* Emin
   VUCON_STOLOAD(IY411,IA,IGUC,IS3,T)*GDATA(IGUC,'GDUCGMIN')*GDATA(IGUC,'GDUCUNITSIZE')*(1-GDATA(IGUC,'GDUCF0'))
* Emax
   +VUCON_STOLOAD(IY411,IA,IGUC,IS3,T)*GDATA(IGUC,'GDUCUNITSIZE')*GDATA(IGUC,'GDUCF0')
* FE
   )/GDATA(IGUC,'GDSTOHLOAD')
   )
    =G=
    VASFCRUP(IY411,IA,IGUC,IS3,T)$IASFCRUP(IGUC) +VASAFRRUP(IY411,IA,IGUC,IS3,T)$IASAFRRUP(IGUC)
;


QASSTOONDOWN(IY411,IA,IGUC,IS3,T)$(IAGK_HASORPOT(IY411,IA,IGUC) AND IGESTOALL(IGUC) AND (IASFCRDOWN(IGUC) OR IASAFRRDOWN(IGUC)))..
   VUCON_STOLOAD(IY411,IA,IGUC,IS3,T)*GDATA(IGUC,'GDUCUNITSIZE')/GDATA(IGUC,'GDSTOHLOAD')
   -(
   VESTOLOADT(IY411,IA,IGUC,IS3,T)$IGESTO(IGUC)
  +VESTOLOADTS(IY411,IA,IGUC,IS3,T)$IGESTOS(IGUC)
    )

+(
    VGE_T(IY411,IA,IGUC,IS3,T)

   -
* Fuel consumption at minimum load is defined by Fmin = [ Emin (1-F0) +Emax*F0 ]/FE
  (
* Emin
   VUCON(IY411,IA,IGUC,IS3,T)*GDATA(IGUC,'GDUCGMIN')*GDATA(IGUC,'GDUCUNITSIZE')*(1-GDATA(IGUC,'GDUCF0'))
* Emax
   +VUCON(IY411,IA,IGUC,IS3,T)*GDATA(IGUC,'GDUCUNITSIZE')*GDATA(IGUC,'GDUCF0')
* FE
   )/GDATA(IGUC,'GDSTOHUNLD')*(GDATA(IGUC,'GDFE')*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC)))
   )
    =G=
    VASFCRDOWN(IY411,IA,IGUC,IS3,T)$IASFCRDOWN(IGUC) +VASAFRRDOWN(IY411,IA,IGUC,IS3,T)$IASAFRRDOWN(IGUC)
;


QASESTOONENERGYUP(IY411,IA,IGUC,IS3,T)$(IAGK_HASORPOT(IY411,IA,IGUC) AND IGESTO(IGUC) AND (IASFCRUP(IGUC) OR IASAFRRUP(IGUC)))..
  VESTOVOLT(IY411,IA,IGUC,IS3,T)
  +   CHRONOHOUR(IS3,T)*
      (VESTOLOADT(IY411,IA,IGUC,IS3,T)
      - SUM(IAGK_HASORPOT(IY411,IA,IGUC), VGE_T(IY411,IA,IGUC,IS3,T)/GDATA(IGUC,'GDFE')) )
   =G=
   ((VASFCRUP(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_FCR)$IASFCRUP(IGUC) + (VASAFRRUP(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_AFRR)$IASAFRRUP(IGUC))/GDATA(IGUC,'GDFE')

;

QASESTOONENERGYDOWN(IY411,IA,IGUC,IS3,T)$(IAGK_HASORPOT(IY411,IA,IGUC) AND IGESTO(IGUC) AND (IASFCRDOWN(IGUC) OR IASAFRRDOWN(IGUC)))..
   GKFX(IY411,IA,IGUC)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM(IY411,IA,IGUC)$IGDECOMEXOPOT(IY411,IA,IGUC)
   + VGKNACCUMNET(IY411,IA,IGUC)$SUM(Y$(YVALUE(Y) LE YVALUE(IY411)),IAGKNY(Y,IA,IGUC))
- (
  VESTOVOLT(IY411,IA,IGUC,IS3,T)
  +   CHRONOHOUR(IS3,T)*
      (VESTOLOADT(IY411,IA,IGUC,IS3,T)
      - SUM(IAGK_HASORPOT(IY411,IA,IGUC), VGE_T(IY411,IA,IGUC,IS3,T)/GDATA(IGUC,'GDFE')) )
   )
   =G=
   (VASFCRDOWN(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_FCR)$IASFCRDOWN(IGUC) + (VASAFRRDOWN(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_AFRR)$IASAFRRDOWN(IGUC)
;

QASESTOSONENERGYUP(IY411,IA,IGUC,IS3,T)$(IAGK_HASORPOT(IY411,IA,IGUC) AND IGESTOS(IGUC) AND (IASFCRUP(IGUC) OR IASAFRRUP(IGUC)))..
  VESTOVOLTS(IY411,IA,IGUC,IS3,T)
  +   CHRONOHOUR(IS3,T)*
      (VESTOLOADTS(IY411,IA,IGUC,IS3,T)
      - SUM(IAGK_HASORPOT(IY411,IA,IGUC), VGE_T(IY411,IA,IGUC,IS3,T)/GDATA(IGUC,'GDFE')) )
   =G=
   ((VASFCRUP(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_FCR)$IASFCRUP(IGUC) + (VASAFRRUP(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_AFRR)$IASAFRRUP(IGUC))/GDATA(IGUC,'GDFE')

;

QASESTOSONENERGYDOWN(IY411,IA,IGUC,IS3,T)$(IAGK_HASORPOT(IY411,IA,IGUC) AND IGESTOS(IGUC) AND (IASFCRDOWN(IGUC) OR IASAFRRDOWN(IGUC)))..
   GKFX(IY411,IA,IGUC)
$ifi %DECOM%==yes   -VDECOM_EXO_ACCUM(IY411,IA,IGUC)$IGDECOMEXOPOT(IY411,IA,IGUC)
   + VGKNACCUMNET(IY411,IA,IGUC)$SUM(Y$(YVALUE(Y) LE YVALUE(IY411)),IAGKNY(Y,IA,IGUC))
- (
  VESTOVOLTS(IY411,IA,IGUC,IS3,T)
  +   CHRONOHOUR(IS3,T)*
      (VESTOLOADTS(IY411,IA,IGUC,IS3,T)
      - SUM(IAGK_HASORPOT(IY411,IA,IGUC), VGE_T(IY411,IA,IGUC,IS3,T)/GDATA(IGUC,'GDFE')) )
   )
   =G=
   (VASFCRDOWN(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_FCR)$IASFCRDOWN(IGUC) + (VASAFRRDOWN(IY411,IA,IGUC,IS3,T)*MIN_TIMEON_AFRR)$IASAFRRDOWN(IGUC)
;


