* Ancilliary services by Juan Gea Bermúdez 2019.

+(
   (
   +(VASFCRUP(IY411,IA,IGUC,IS3,T)/(GDATA(IGUC,'GDFE')*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC))))$(NOT(IGETOH(IGUC)))
   +(VASFCRDOWN(IY411,IA,IGUC,IS3,T))$IGETOH(IGUC)
   )*(1+(1/GDATA(IGUC,'GDCB'))$IGBPR(IGUC))
 )$(IASFCRUP(IGUC)  AND NOT(IGESTOALL(IGUC))
$ifi %HYDROGEN%==yes   AND NOT(IHYDROGEN_GETOH2(IGUC) OR IHYDROGEN_GEHTOH2(IGUC) OR IHYDROGEN_GH2TOBIOMETH(IGUC))
 )

+(
   (
   +(VASAFRRUP(IY411,IA,IGUC,IS3,T)/(GDATA(IGUC,'GDFE')*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC))))$(NOT(IGETOH(IGUC)))
   +(VASAFRRDOWN(IY411,IA,IGUC,IS3,T))$IGETOH(IGUC)
   )*(1+(1/GDATA(IGUC,'GDCB'))$IGBPR(IGUC))
 )$(IASAFRRUP(IGUC)  AND NOT(IGESTOALL(IGUC))
$ifi %HYDROGEN%==yes   AND NOT(IHYDROGEN_GETOH2(IGUC) OR IHYDROGEN_GEHTOH2(IGUC) OR IHYDROGEN_GH2TOBIOMETH(IGUC))
 )





$ifi not %HYDROGEN%==yes  $goto NO_HYDROGEN
+(
   +(VASFCRDOWN(IY411,IA,IGUC,IS3,T)/DAC_DE(IGUC)/(GDATA(IGUC,'GDFE')*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC))))$(IHYDROGEN_GH2TOBIOMETH(IGUC))
   +(VASFCRDOWN(IY411,IA,IGUC,IS3,T)*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC)))$(IHYDROGEN_GETOH2(IGUC) OR IHYDROGEN_GEHTOH2(IGUC))
 )$(IASFCRUP(IGUC))


+(
   +(VASAFRRDOWN(IY411,IA,IGUC,IS3,T)/DAC_DE(IGUC)/(GDATA(IGUC,'GDFE')*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC))))$(IHYDROGEN_GH2TOBIOMETH(IGUC))
   +(VASAFRRDOWN(IY411,IA,IGUC,IS3,T)*(1$(NOT GEFFRATE(IA,IGUC))+GEFFRATE(IA,IGUC)))$(IHYDROGEN_GETOH2(IGUC) OR IHYDROGEN_GEHTOH2(IGUC))
 )$(IASAFRRUP(IGUC))
$label NO_HYDROGEN
